<template>
  <layout>
    <!--a finir-->
    <form @submit.prevent="connexion">
      <table class="mx-auto flex flex-col items-center">
        <h1 class="text-blue-400 text-center text-xl">
          Connetez vous Ã  votre compte !
        </h1>
        <!--email-->
        <tr>
          <td>
            <input
              v-model="email"
              class="p-5 text-lg border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-400 focus:text-pink-400"
              name="email"
              placeholder="Adresse email"
            />
          </td>
        </tr>

        <tr>
          <td>
            <input
              v-model="password"
              class="p-5 text-lg border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-400 focus:text-pink-400"
              name="mdp"
              type="text"
              placeholder="Mot de passe"
            />
          </td>
        </tr>
        <tr>
          <td>
            <span>Pas encore de compte ?</span
            ><g-link class="text-blue-400 text-lg" to="/register">
              Inscrivez vous ici !
            </g-link>
          </td>
        </tr>
        <!--submit-->
        <tr>
          <td>
            <button
              class="p-3 text-lg flex my-2 mx-auto bg-gray-600 hover:bg-pink-400 rounded-lg text-white uppercase"
              type="submit"
            >
              Connexion
            </button>
          </td>
        </tr>
      </table>
    </form>
  </layout>
</template>

<script>
const axios = require("axios");
export default {
  metaInfo: {
    title: "Connexion",
  },
  //==================================================================================================================================================================================================================================================================================================
  //
  //  ####      ###    ######    ###
  //  ##  ##   ## ##     ##     ## ##
  //  ##  ##  ##   ##    ##    ##   ##
  //  ##  ##  #######    ##    #######
  //  ####    ##   ##    ##    ##   ##
  //
  //==================================================================================================================================================================================================================================================================================================

  data() {
    return {
      tokenContent: "",
      email: "",
      password: "",
    };
  },
  //============================================================================================================================================================================================================================================================================================================================
  //
  //  ###    ###  #####  ######  ##   ##   #####   ####     ####
  //  ## #  # ##  ##       ##    ##   ##  ##   ##  ##  ##  ##
  //  ##  ##  ##  #####    ##    #######  ##   ##  ##  ##   ###
  //  ##      ##  ##       ##    ##   ##  ##   ##  ##  ##     ##
  //  ##      ##  #####    ##    ##   ##   #####   ####    ####
  //
  //============================================================================================================================================================================================================================================================================================================================

  methods: {
    connexion() {
      axios
        .post("http://127.0.0.1:8000/api/login_check", {
          email: this.email,
          password: this.password,
        })
        .then((response) => {
          // handle success
          this.$router.push("/?");
          console.log("token: ", response);

          this.tokenContent = response.data;
          const user = {
            name: this.email,
            jwt: this.tokenContent.token
          }
          //stockage du token
          localStorage.setItem("jwt", JSON.stringify(user));
        })
        // .catch((error) => {
        //   console.log("error", error.response.data);
        //   this.error = error.response.data.errors.violations[0].title;
        // });
    },
  },
  //=======================================================================================================================================================================================================================================================================================================================
  //
  //   ####  #####    #####    ###    ######  #####  ####
  //  ##     ##  ##   ##      ## ##     ##    ##     ##  ##
  //  ##     #####    #####  ##   ##    ##    #####  ##  ##
  //  ##     ##  ##   ##     #######    ##    ##     ##  ##
  //   ####  ##   ##  #####  ##   ##    ##    #####  ####
  //
  //=======================================================================================================================================================================================================================================================================================================================

  created() {},
};
</script>
